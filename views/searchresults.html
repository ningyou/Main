<table id="searchresults" class="table table-striped table-bordered">
	<thead>
		<tr>
			<th class="span12">
				Title
			</th>
			<th class="span2 center">
				Type
			</th>
			<th class="center">
				Episodes
			</th>
		</tr>
	</thead>
	<tbody>
	{% for _,h in next, results do %}
		<tr>
			<td>
				<a href="#">{{h.title}}</a>
				<a class="pull-right" href="{{url}}{{h.id}}" target="_blank">More info</a>
				<div class="hide">
					<br/>
					<form id="search_add_{{h.id}}">
						<select name="list_name" class="input-medium">
							{% if lists then for i = 1, #lists do %}
							<option>{{lists[i].name}}</option>
							{% end end %}
						</select>
						<select name="status" class="input-medium">
							{% for i = 1, #status do %}
							<option>{{status[i]}}</option>
							{% end %}
						</select>
						<input name="episodes" class="center input-mini" type="number" value="0" />
						<input name="id" type="hidden" value="{{h.id}}" />
						<input name="user" type="hidden" value="{{logged_user}}" />
						<input type="submit" class="btn" value="Add" />
					</form>
				</div>
			</td>
			<td class="center">
				{{h.type}}
			</td>
			<td class="center">
				{{h.total}}
			</td>
		</tr>
	{% end %}
	</tbody>
</table>

<script>
	$('table[id="searchresults"] > tbody> tr > td a:first-child').on('click', function()
	{
		$(this).parent().find("div").toggle();
		return false;
	});
	$('form[id^="search_add"]').submit(function(event)
	{
		event.preventDefault();
		var list = $(this).find($('select[name="list_name"]')).val()
		if(list)
		{
			var ep = $(this).find($('input[name="episodes"]')).val() | 0;
			var total = $(this).parents('tr').find($('td:last-child')).html() | 0;
			if(total) { if(ep >= total) { ep = total; }}
			$(this).find($('input[name="episodes"]')).val(ep);
			$.ajax({
				type: "POST",
				url: "/add/episode",
				data: $(this).serializeArray(),
			}).done(function()
			{
				topalert("Show added.");
			});
			$(this).parents('tr').remove();
		} else
		{
			topalert("No list found.")
		}
	});
</script>
